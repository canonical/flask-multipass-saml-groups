name: Release a new version of the plugin

on:
  push:
    branches:
    #   - main
      - versioning_with_poetry

jobs:
    create-release:
        name: Create Github release
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4.1.1
            - name: Set up Python 3.10
              uses: actions/setup-python@v5
              with:
                python-version: "3.10"

            - name: Install Poetry
              run: |
                curl -sSL https://install.python-poetry.org | python - -y
                echo "$HOME/.local/bin" >> $GITHUB_PATH

            - name: Bump Version
              id: bump-version
              run: |
                poetry version minor
                VERSION=$(poetry version --short)
                echo version=${VERSION} >> $GITHUB_OUTPUT
                git tag '$VERSION'
                git push origin '$VERSION'
                git add .
                git commit -m "Bump version to ${VERSION}"
                git push

            - name: Create Release
              uses: ncipollo/release-action@v1
              with:
                token: ${{ secrets.GITHUB_TOKEN }}
                draft: true
                tag: ${{ steps.bump-vesion.outputs.version }}
